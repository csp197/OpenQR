#!/bin/sh
# Pre-push hook: warn if pushing to main with an existing version tag

remote="$1"

while read local_ref local_sha remote_ref remote_sha; do
  # Only check pushes to main
  if [ "$remote_ref" = "refs/heads/main" ]; then
    # Read version from tauri.conf.json
    version=$(grep '"version"' src-tauri/tauri.conf.json | head -1 | sed 's/.*"\([0-9][0-9.]*\)".*/\1/')

    if [ -n "$version" ]; then
      tag="v${version}"
      if git rev-parse "$tag" >/dev/null 2>&1; then
        echo ""
        echo "  WARNING: Tag '$tag' already exists."
        echo "  If this is a new release, bump the version in src-tauri/tauri.conf.json"
        echo ""
      fi
    fi
  fi
done

exit 0
